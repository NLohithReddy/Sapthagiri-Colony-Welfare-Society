<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fund Tracker - Sapthagiri Colony Welfare Society</title>
  <link rel="icon" type="image/png" href="assets/favicon.jpg" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/style.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">
  <style>
    body { font-family: 'Poppins', sans-serif; display: flex; flex-direction: column; min-height: 100vh; background-color: #f9f9f9; }
    main { flex: 1; }
    .navbar, .offcanvas { background-color: #3F51B5 !important; }
    .navbar-brand, .nav-link { color: #fff !important; }
    h2, h5 { color: #009688; }
    .table-container { overflow-x: auto; }
    footer { background-color: #2E3A59; color: white; font-size: 0.9rem; }
    .offcanvas-header { border-bottom: 1px solid rgba(255, 255, 255, 0.2); }
    .lang-en { display: block; }
    .lang-te { display: none; }
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-dark px-3">
  <div class="container-fluid d-flex justify-content-between align-items-center">
    <a class="navbar-brand">Sapthagiri Colony Welfare Society</a>
    <div class="d-none d-lg-flex">
      <ul class="navbar-nav flex-row gap-3 align-items-center mb-0">
        <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="about.html">About</a></li>
        <li class="nav-item"><a class="nav-link" href="announcements.html">Announcements</a></li>
        <li class="nav-item"><a class="nav-link" href="fundtracker.html">Fund Tracker</a></li>
        <li class="nav-item"><a class="nav-link" href="events.html">Events</a></li>
        <li class="nav-item"><a class="nav-link" href="gallery.html">Gallery</a></li>
        <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
        <li class="nav-item">
          <button class="btn btn-sm btn-light me-1" onclick="setLanguage('en')">English</button>
          <button class="btn btn-sm btn-warning" onclick="setLanguage('te')">తెలుగు</button>
        </li>
      </ul>
    </div>
    <button class="navbar-toggler d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#mobileMenu">
      <span class="navbar-toggler-icon"></span>
    </button>
  </div>
</nav>

<!-- Offcanvas Mobile Menu -->
<div class="offcanvas offcanvas-start text-bg-primary" tabindex="-1" id="mobileMenu">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title">Menu</h5>
    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body">
    <ul class="navbar-nav">
      <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
      <li class="nav-item"><a class="nav-link" href="about.html">About</a></li>
      <li class="nav-item"><a class="nav-link" href="announcements.html">Announcements</a></li>
      <li class="nav-item"><a class="nav-link" href="fundtracker.html">Fund Tracker</a></li>
      <li class="nav-item"><a class="nav-link" href="events.html">Events</a></li>
      <li class="nav-item"><a class="nav-link" href="gallery.html">Gallery</a></li>
      <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
    </ul>
    <hr>
    <div>
      <button class="btn btn-sm btn-light w-100 mb-2" onclick="setLanguage('en')">English</button>
      <button class="btn btn-sm btn-warning w-100" onclick="setLanguage('te')">తెలుగు</button>
    </div>
  </div>
</div>

<!-- Main Content -->
<main>
  <section class="container my-5">
    <h2 class="text-center mb-4">
      <span class="lang-en">Colony Fund Tracker - Contributions & Expenses (Sample Data)</span>
      <span class="lang-te">కాలనీ నిధుల సమాచారం - విరాళాలు మరియు ఖర్చులు</span>
    </h2>

    <!-- Contributions Table -->
    <h5>
  <span class="lang-en">Monthly Contributions</span>
  <span class="lang-te">నెలవారీ విరాళాలు</span>
</h5>

    <div class="table-container mb-5">
      <table id="contributionsTable" class="display nowrap table table-bordered table-striped" style="width:100%">
        <thead><tr><th>Loading...</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Expenditure Table -->
    <h5>
  <span class="lang-en">Expenditure Details</span>
  <span class="lang-te">ఖర్చుల వివరాలు</span>
</h5>

    <div class="table-container mb-5">
      <table id="expenditureTable" class="display nowrap table table-bordered table-striped" style="width:100%">
        <thead><tr><th>Loading...</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Summary -->
    <div class="mt-4">
      <h5>
  <strong>
    <span class="lang-en">Total Fund Collected:</span>
    <span class="lang-te">మొత్తం సేకరించిన నిధి:</span>
  </strong>
  <span id="totalCollected">Calculating...</span>
</h5>

<h5>
  <strong>
    <span class="lang-en">Total Spent:</span>
    <span class="lang-te">మొత్తం ఖర్చు:</span>
  </strong>
  <span id="totalSpent">Calculating...</span>
</h5>

<h5>
  <strong>
    <span class="lang-en">Current Balance:</span>
    <span class="lang-te">ప్రస్తుత నిల్వ:</span>
  </strong>
  <span id="currentBalance">Calculating...</span>
</h5>

    </div>
  </section>
</main>

<!-- Footer -->
<footer class="text-center py-3">
  <p class="mb-0">
    <span class="lang-en">&copy; 2025 Sapthagiri Colony Welfare Society. All rights reserved. | <a href="developer.html" class="text-light text-decoration-underline">Developer</a></span>
    <span class="lang-te">&copy; 2025 సప్తగిరి కాలనీ సంక్షేమ సంఘం. అన్ని హక్కులు రిజర్వు. | <a href="developer.html" class="text-light text-decoration-underline">డెవలపర్</a></span>
  </p>
</footer>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
function loadCSVData(url, tableId, isContributions) {
  fetch(url)
    .then(response => response.text())
    .then(data => {
      const rows = data.trim().split('\n').map(r => r.split(','));

      // Add "Total" column if contributions table
      if (isContributions) {
        if (!rows[0].includes('Total')) {
          rows[0].push('Total');
        }

        for (let i = 1; i < rows.length; i++) {
          const amountCols = rows[i].slice(2).map(val => parseInt(val.trim()) || 0);
          const total = amountCols.reduce((a, b) => a + b, 0);
          rows[i].push(total);
        }
      }

      const table = $('#' + tableId);
      table.empty();

      // Build HTML for thead
      let thead = '<thead><tr>';
      rows[0].forEach(col => thead += `<th>${col}</th>`);
      thead += '</tr></thead>';

      // Build HTML for tbody
      let tbody = '<tbody>';
      for (let i = 1; i < rows.length; i++) {
        tbody += '<tr>';
        rows[i].forEach(col => tbody += `<td>${col}</td>`);
        tbody += '</tr>';
      }
      tbody += '</tbody>';

      // Append to table
      table.append(thead + tbody);

      // Initialize DataTable
      table.DataTable({
        dom: 'Bfrtip',
        buttons: ['excelHtml5', 'csvHtml5'],
        scrollX: true,
        destroy: true,
        initComplete: () => {
          if (isContributions) calculateFundSummary();
        }
      });
    })
    .catch(error => console.error("CSV Load Error:", error));
}

function calculateFundSummary() {
  let totalCollected = 0;

  // Get DataTable API instance
  const table = $('#contributionsTable').DataTable();

  // Loop through all rows (not just DOM ones)
  table.rows().every(function () {
    const data = this.data();
    const lastCell = parseInt(data[data.length - 1].replace(/[^0-9]/g, '')) || 0;
    totalCollected += lastCell;
  });

  let totalSpent = 0;
  $('#expenditureTable tbody tr').each(function () {
    let spent = $(this).find('td:nth-child(3)').text().replace(/[^0-9]/g, '');
    totalSpent += parseInt(spent) || 0;
  });

  const balance = totalCollected - totalSpent;

  $('#totalCollected').text('₹' + totalCollected.toLocaleString());
  $('#totalSpent').text('₹' + totalSpent.toLocaleString());
  $('#currentBalance').text('₹' + balance.toLocaleString());
}


function setLanguage(lang) {
  document.querySelectorAll('.lang-en').forEach(el => el.style.display = (lang === 'en') ? 'block' : 'none');
  document.querySelectorAll('.lang-te').forEach(el => el.style.display = (lang === 'te') ? 'block' : 'none');
}

document.addEventListener('DOMContentLoaded', () => {
  loadCSVData('https://docs.google.com/spreadsheets/d/e/2PACX-1vS4XUvpAO7tsvY0X3N4qqAneIskdQ43W4tVdIhrlmKl9-e8kgah6bfGh6pIfCWcJPNz9KxgeeVL4tXo/pub?gid=0&single=true&output=csv', 'contributionsTable', true);
  loadCSVData('https://docs.google.com/spreadsheets/d/e/2PACX-1vS4XUvpAO7tsvY0X3N4qqAneIskdQ43W4tVdIhrlmKl9-e8kgah6bfGh6pIfCWcJPNz9KxgeeVL4tXo/pub?gid=962933700&single=true&output=csv', 'expenditureTable', false);
});
</script>

<!-- Weather Widget -->
<a class="weatherwidget-io" href="https://forecast7.com/en/17d63n78d08/sangareddy/" data-label_1="SANGAREDDY" data-label_2="WEATHER" data-theme="original">SANGAREDDY WEATHER</a>
<script>
!function(d,s,id){
  var js,fjs=d.getElementsByTagName(s)[0];
  if(!d.getElementById(id)){
    js=d.createElement(s);js.id=id;js.src='https://weatherwidget.io/js/widget.min.js';
    fjs.parentNode.insertBefore(js,fjs);
  }
}(document,'script','weatherwidget-io-js');
</script>

</body>
</html>
